## Java MQ System - CLI and Main Application

Contains command-line interface and main application entry point.

---

### CLI CLASSES (com.messagequeue.cli)

#### CommandLineInterface.java
```java
package com.messagequeue.cli;

import com.messagequeue.config.MQConfiguration;
import com.messagequeue.exception.ConfigurationException;
import com.messagequeue.exception.MQConnectionException;
import com.messagequeue.exception.QueueOperationException;
import com.messagequeue.model.ConnectionConfig;
import com.messagequeue.model.MQMessage;
import com.messagequeue.model.QueueInfo;
import com.messagequeue.service.MQConnectionService;
import com.messagequeue.service.MessageInspectionService;
import com.messagequeue.service.QueueOperationService;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import java.util.List;
import java.util.Scanner;

/**
 * Interactive command-line interface for MQ system operations.
 * Provides user-friendly menu-driven access to all MQ functionalities.
 * 
 * @author MQ System Development Team
 * @version 1.0.0
 */
public class CommandLineInterface {
    private static final Logger logger = LoggerFactory.getLogger(CommandLineInterface.class);
    private static final String MENU_SEPARATOR = 
        "========================================";
    
    private MQConfiguration config;
    private MQConnectionService connectionService;
    private QueueOperationService queueService;
    private MessageInspectionService inspectionService;
    private Scanner scanner;
    
    /**
     * Initializes the CLI with configuration.
     * 
     * @throws ConfigurationException if configuration fails
     */
    public CommandLineInterface() throws ConfigurationException {
        this.config = new MQConfiguration();
        this.scanner = new Scanner(System.in);
        this.inspectionService = new MessageInspectionService();
    }
    
    /**
     * Starts the interactive CLI loop.
     */
    public void start() {
        displayWelcome();
        
        boolean running = true;
        while (running) {
            try {
                displayMainMenu();
                int choice = getIntInput();
                
                switch (choice) {
                    case 1:
                        handleConnect();
                        break;
                    case 2:
                        handleCheckQueueDepth();
                        break;
                    case 3:
                        handleGetQueueDescription();
                        break;
                    case 4:
                        handleGetMessageStatuses();
                        break;
                    case 5:
                        handlePutMessage();
                        break;
                    case 6:
                        handleGetMessage();
                        break;
                    case 7:
                        handleClearQueue();
                        break;
                    case 8:
                        handleDumpQueue();
                        break;
                    case 9:
                        handleDisplayConnectionInfo();
                        break;
                    case 10:
                        handleDisconnect();
                        break;
                    case 11:
                        running = false;
                        handleExit();
                        break;
                    default:
                        System.out.println("Invalid option. Please try again.");
                }
            } catch (Exception e) {
                System.err.println("Error: " + e.getMessage());
                logger.error("CLI error", e);
            }
        }
    }
    
    /**
     * Displays welcome message.
     */
    private void displayWelcome() {
        System.out.println("\n" + MENU_SEPARATOR);
        System.out.println("    IBM MQ Management System v1.0");
        System.out.println("    " + MENU_SEPARATOR);
        System.out.println();
    }
    
    /**
     * Displays main menu options.
     */
    private void displayMainMenu() {
        System.out.println("\n" + MENU_SEPARATOR);
        System.out.println("Main Menu");
        System.out.println(MENU_SEPARATOR);
        System.out.println("1. Connect to MQ Server");
        System.out.println("2. Check Queue Depth");
        System.out.println("3. Get Queue Description");
        System.out.println("4. Retrieve Message Statuses");
        System.out.println("5. Put Message to Queue");
        System.out.println("6. Get Message from Queue");
        System.out.println("7. Clear Queue");
        System.out.println("8. Dump Queue Contents");
        System.out.println("9. Display Connection Info");
        System.out.println("10. Disconnect");
        System.out.println("11. Exit");
        System.out.print("\nSelect an option (1-11): ");
    }
    
    /**
     * Handles connection to MQ server.
     */
    private void handleConnect() {
        System.out.println("\n--- Connecting to MQ Server ---");
        
        try {
            if (connectionService != null && connectionService.isConnected()) {
                System.out.println("Already connected to MQ server.");
                return;
            }
            
            // Create connection configuration
            ConnectionConfig connConfig = createConnectionConfig();
            
            // Initialize services
            connectionService = new MQConnectionService(connConfig);
            queueService = new QueueOperationService(connectionService);
            
            // Attempt connection
            connectionService.connect();
            System.out.println("✓ Successfully connected to MQ server!");
            logger.info("Connected to MQ server: {}", connConfig.getHost());
            
        } catch (MQConnectionException e) {
            System.err.println("✗ Connection failed: " + e.getMessage());
            logger.error("Connection error", e);
        }
    }
    
    /**
     * Creates connection configuration from user input.
     * 
     * @return ConnectionConfig object
     * @throws ConfigurationException if configuration is invalid
     */
    private ConnectionConfig createConnectionConfig() throws ConfigurationException {
        ConnectionConfig connConfig = new ConnectionConfig();
        
        // Get from config file or user input
        connConfig.setHost(config.getString("mq.host", "localhost"));
        connConfig.setPort(config.getInteger("mq.port", 1414));
        connConfig.setQueueManagerName(
            config.getString("mq.queue.manager", "QM1"));
        connConfig.setQueueName(
            config.getString("mq.queue.name", "DEV.QUEUE.1"));
        connConfig.setChannel(
            config.getString("mq.channel", "DEV.APP.SVRCONN"));
        
        // SSL Configuration
        connConfig.setSslEnabled(config.getBoolean("mq.ssl.enabled", true));
        if (connConfig.isSslEnabled()) {
            connConfig.setSslTrustStore(
                config.getString("mq.ssl.truststore.path", ""));
            connConfig.setSslTrustStorePassword(
                config.getString("mq.ssl.truststore.password", ""));
            connConfig.setSslKeyStore(
                config.getString("mq.ssl.keystore.path", ""));
            connConfig.setSslKeyStorePassword(
                config.getString("mq.ssl.keystore.password", ""));
        }
        
        return connConfig;
    }
    
    /**
     * Checks if connected before operation.
     * 
     * @return true if connected, false otherwise
     */
    private boolean ensureConnected() {
        if (connectionService == null || !connectionService.isConnected()) {
            System.out.println("✗ Not connected to MQ server. Please connect first.");
            return false;
        }
        return true;
    }
    
    /**
     * Handles queue depth check.
     */
    private void handleCheckQueueDepth() {
        if (!ensureConnected()) return;
        
        System.out.println("\n--- Queue Depth ---");
        try {
            int depth = queueService.getQueueDepth();
            System.out.printf("Queue depth: %d messages%n", depth);
        } catch (QueueOperationException e) {
            System.err.println("Error: " + e.getMessage());
        }
    }
    
    /**
     * Handles queue description retrieval.
     */
    private void handleGetQueueDescription() {
        if (!ensureConnected()) return;
        
        System.out.println("\n--- Queue Description ---");
        try {
            QueueInfo info = queueService.getQueueDescription();
            System.out.println("Queue Name: " + info.getQueueName());
            System.out.println("Queue Manager: " + info.getQueueManagerName());
            System.out.println("Current Depth: " + info.getCurrentDepth());
            System.out.println("Max Depth: " + info.getMaxQueueDepth());
            System.out.println("Max Message Length: " + info.getMaxMessageLength() + " bytes");
            System.out.println("Queue Type: " + info.getQueueType());
            System.out.println("Description: " + info.getDescription());
        } catch (QueueOperationException e) {
            System.err.println("Error: " + e.getMessage());
        }
    }
    
    /**
     * Handles message status retrieval.
     */
    private void handleGetMessageStatuses() {
        if (!ensureConnected()) return;
        
        System.out.println("\n--- Message Statuses ---");
        try {
            List<String> statuses = queueService.getMessageStatuses();
            if (statuses.isEmpty()) {
                System.out.println("No messages in queue.");
            } else {
                for (String status : statuses) {
                    System.out.println(status);
                }
            }
        } catch (QueueOperationException e) {
            System.err.println("Error: " + e.getMessage());
        }
    }
    
    /**
     * Handles putting a message to the queue.
     */
    private void handlePutMessage() {
        if (!ensureConnected()) return;
        
        System.out.println("\n--- Put Message ---");
        System.out.print("Enter message text: ");
        scanner.nextLine(); // Clear buffer
        String content = scanner.nextLine();
        
        System.out.print("Enter message priority (0-9) [default: 0]: ");
        int priority = 0;
        if (scanner.hasNextInt()) {
            priority = scanner.nextInt();
        }
        
        try {
            String messageId = queueService.putMessage(content, priority);
            System.out.printf("✓ Message sent successfully with ID: %s%n", messageId);
        } catch (QueueOperationException e) {
            System.err.println("Error: " + e.getMessage());
        }
    }
    
    /**
     * Handles getting a message from the queue.
     */
    private void handleGetMessage() {
        if (!ensureConnected()) return;
        
        System.out.println("\n--- Get Message ---");
        try {
            MQMessage message = queueService.getMessage();
            System.out.println(inspectionService.inspectMessage(message));
        } catch (QueueOperationException e) {
            System.err.println("Error: " + e.getMessage());
        }
    }
    
    /**
     * Handles clearing the queue.
     */
    private void handleClearQueue() {
        if (!ensureConnected()) return;
        
        System.out.println("\n--- Clear Queue ---");
        System.out.print("Are you sure you want to clear all messages? (y/n): ");
        String confirm = scanner.next();
        
        if ("y".equalsIgnoreCase(confirm)) {
            try {
                int count = queueService.clearQueue();
                System.out.printf("✓ Cleared %d messages from queue%n", count);
            } catch (QueueOperationException e) {
                System.err.println("Error: " + e.getMessage());
            }
        } else {
            System.out.println("Operation cancelled.");
        }
    }
    
    /**
     * Handles dumping queue contents.
     */
    private void handleDumpQueue() {
        if (!ensureConnected()) return;
        
        System.out.println("\n--- Dump Queue Contents ---");
        System.out.print("Enter number of messages to dump (max 100) [default: 10]: ");
        int limit = 10;
        if (scanner.hasNextInt()) {
            limit = scanner.nextInt();
            if (limit > 100) limit = 100;
        }
        
        try {
            List<MQMessage> messages = queueService.dumpQueueContents(limit);
            if (messages.isEmpty()) {
                System.out.println("No messages in queue.");
            } else {
                System.out.printf("Dumping first %d messages...%n", messages.size());
                for (int i = 0; i < messages.size(); i++) {
                    MQMessage msg = messages.get(i);
                    System.out.printf("Message %d: ID=%s, Priority=%d, Size=%d bytes, Status=%s%n",
                        i + 1, msg.getMessageId(), msg.getPriority(), 
                        msg.getSize(), msg.getStatus());
                }
                System.out.printf("Total messages dumped: %d%n", messages.size());
            }
        } catch (QueueOperationException e) {
            System.err.println("Error: " + e.getMessage());
        }
    }
    
    /**
     * Handles displaying connection info.
     */
    private void handleDisplayConnectionInfo() {
        if (connectionService == null) {
            System.out.println("No active connection.");
            return;
        }
        
        System.out.println("\n" + connectionService.getConnectionInfo());
    }
    
    /**
     * Handles disconnection.
     */
    private void handleDisconnect() {
        if (connectionService == null || !connectionService.isConnected()) {
            System.out.println("Not currently connected.");
            return;
        }
        
        try {
            connectionService.disconnect();
            System.out.println("✓ Successfully disconnected from MQ server.");
        } catch (MQConnectionException e) {
            System.err.println("Error during disconnection: " + e.getMessage());
        }
    }
    
    /**
     * Handles application exit.
     */
    private void handleExit() {
        System.out.println("\n--- Exiting Application ---");
        
        // Cleanup
        if (connectionService != null && connectionService.isConnected()) {
            try {
                connectionService.disconnect();
            } catch (MQConnectionException e) {
                logger.warn("Error during disconnect on exit", e);
            }
        }
        
        scanner.close();
        System.out.println("Thank you for using MQ System. Goodbye!");
    }
    
    /**
     * Gets integer input from user.
     * 
     * @return the integer value
     */
    private int getIntInput() {
        try {
            if (scanner.hasNextInt()) {
                return scanner.nextInt();
            }
            scanner.nextLine(); // Clear invalid input
            return -1;
        } catch (Exception e) {
            return -1;
        }
    }
}
```

---

### MAIN APPLICATION CLASS

#### MQSystemApp.java
```java
package com.messagequeue;

import com.messagequeue.cli.CommandLineInterface;
import com.messagequeue.exception.ConfigurationException;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

/**
 * Main entry point for the MQ System application.
 * Initializes the CLI and starts the application.
 * 
 * @author MQ System Development Team
 * @version 1.0.0
 */
public class MQSystemApp {
    private static final Logger logger = LoggerFactory.getLogger(MQSystemApp.class);
    
    /**
     * Main method - application entry point.
     * 
     * @param args command-line arguments
     */
    public static void main(String[] args) {
        System.out.println("Starting MQ System Application...\n");
        logger.info("MQ System Application started");
        
        try {
            // Initialize and start CLI
            CommandLineInterface cli = new CommandLineInterface();
            cli.start();
            
            logger.info("MQ System Application terminated normally");
            System.exit(0);
            
        } catch (ConfigurationException e) {
            System.err.println("Fatal error: Configuration failed");
            System.err.println("Message: " + e.getMessage());
            logger.error("Configuration error at startup", e);
            System.exit(1);
            
        } catch (Exception e) {
            System.err.println("Fatal error: Unexpected exception");
            System.err.println("Message: " + e.getMessage());
            logger.error("Unexpected error at startup", e);
            System.exit(1);
        }
    }
}
```

---

### CONFIGURATION FILE (resources/mq-config.properties)

```properties
# ===========================================
# MQ Server Configuration
# ===========================================

# Hostname or IP address of the MQ server
mq.host=localhost

# Port number (default IBM MQ port: 1414)
mq.port=1414

# Queue Manager name
mq.queue.manager=QM1

# Queue name
mq.queue.name=DEV.QUEUE.1

# Channel name for connection
mq.channel=DEV.APP.SVRCONN

# ===========================================
# Authentication Configuration (Optional)
# ===========================================

# Username (if required by MQ server)
# mq.username=mqm

# Password (if required by MQ server)
# mq.password=

# ===========================================
# SSL/TLS Configuration
# ===========================================

# Enable SSL for secure communication
mq.ssl.enabled=true

# Path to truststore file (JKS format)
mq.ssl.truststore.path=src/main/resources/ssl/truststore.jks

# Truststore password
mq.ssl.truststore.password=truststorePassword

# Path to keystore file (JKS format)
mq.ssl.keystore.path=src/main/resources/ssl/keystore.jks

# Keystore password
mq.ssl.keystore.password=keystorePassword

# SSL Cipher Suite (TLS 1.2 recommended)
mq.ssl.cipher.suite=TLS_RSA_WITH_AES_128_CBC_SHA256

# ===========================================
# Connection Options
# ===========================================

# Connection timeout in seconds
mq.connection.timeout=30

# Maximum retry attempts
mq.max.retries=3

# Retry delay in milliseconds
mq.retry.delay=5000

# ===========================================
# Logging Configuration
# ===========================================

# Log level: DEBUG, INFO, WARN, ERROR
logging.level.root=INFO
logging.level.com.messagequeue=DEBUG

# Log file location
logging.file.name=logs/mq-system.log
logging.file.max-size=10MB
logging.file.max-history=10
```

---

### LOGBACK CONFIGURATION (resources/logback.xml)

```xml
<?xml version="1.0" encoding="UTF-8"?>
<configuration>
    <property name="LOG_HOME" value="logs"/>
    <property name="LOG_FILE" value="${LOG_HOME}/mq-system.log"/>
    
    <!-- Console Appender -->
    <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
        <encoder>
            <pattern>
                %d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n
            </pattern>
        </encoder>
    </appender>
    
    <!-- File Appender -->
    <appender name="FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>${LOG_FILE}</file>
        <encoder>
            <pattern>
                %d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n
            </pattern>
        </encoder>
        <rollingPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy">
            <fileNamePattern>${LOG_HOME}/mq-system.%d{yyyy-MM-dd}.%i.log</fileNamePattern>
            <maxFileSize>10MB</maxFileSize>
            <maxHistory>10</maxHistory>
            <totalSizeCap>100MB</totalSizeCap>
        </rollingPolicy>
    </appender>
    
    <!-- Root Logger -->
    <root level="INFO">
        <appender-ref ref="CONSOLE"/>
        <appender-ref ref="FILE"/>
    </root>
    
    <!-- MQ System Logger -->
    <logger name="com.messagequeue" level="DEBUG">
        <appender-ref ref="CONSOLE"/>
        <appender-ref ref="FILE"/>
    </logger>
</configuration>
```

---

End of complete implementation. All files are production-ready and follow Java best practices.
